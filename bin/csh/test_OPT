#!/bin/csh -f
  
#############
# optimisation test
############
echo "#include <stdio.h>" > $TMP/test.c
echo 'int no_main(int argc,char ** argv){printf("hello world\n");return(1);}' >> $TMP/test.c
echo "" >> $TMP/test.c
echo "Testing optimisation : $OPTS " >>& /dev/stderr
@ i = 1
set STATUS = 1
while ( $i <= $#OPTS)
  set OPT = "$OPTS[$i]"
  echo "$OPT ..." >>& /dev/stderr
  ${CC} $TMP/test.c -c $OPT -o $TMP/test.o
  if ( $status == 0 ) then
    set STATUS = 0
    break;
  endif
  @ i++
end

if ( $STATUS != 0) then
  echo "optimisation test failed for $OPTS" >>& /dev/stderr
  exit 1;
endif

sed < ${BPMS}/src/makefile 's/__OPT__/'$OPT'/' > $TMP/tmp.$$
mv $TMP/tmp.$$ ${BPMS}/src/makefile
echo "**OPT=$OPT"

