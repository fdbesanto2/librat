#
#
#
#       Makefile librat
#
#       Lewis, RSU, UCL Geography, 1993
#
#
#
#       build executables 

START = start 
LIBRAT = libratlib

ARCH = @ARCH@
OBJ = objects.${ARCH}

BPMS = @BPMS@
LIB = ${BPMS}/lib
BIN = ${BPMS}/bin

CFLAGS = @CFLAGS@
CC = @CC@
DYN = @DYN@
OPT = @OPT@
OS = @OS@


CFLAGS += -I. -DVERBOSE -DDOUBLEDEF -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
CFLAGS += -DMATCHK -D${ARCH} -D_NO_NAG

PRATOBJ = rpv.o cylinderTess.o sphereTess.o ratFront.o disk.o dummy.o dem.o bbox.o facet.o camera.o intersect_objects.o random.o plane.o reflectance.o volumeRayTrace.o sphere.o cylinder.o ellipse.o spheroid.o sky.o sensor_rsr.o files.o mtllib.o bilinear.o dumper.o useful.o prat_wavefront_read.o images.o start.o

ANCOBJS = error.o filelib.o hiplib.o envilib.o imagelib.o libhipl.o r250.o randlcg.o 4D_vectors.o vectors2.o 2D_vectors.o 2D_vectors_double.o 3D_vectors_double.o  allocate.o matrix.o fratP.o matherr.o

STARTOBJS = ${START}.o

all:		${LIBRAT}.so 
		


sick:
		@echo "stick your fingers down your throat"

## windows shared object
## g++ -shared -o example_dll.dll example_dll.o -Wl,--out-implib,libexample_dll.a
##
## sensible (unix-like) shared objects
## $(DYN) -o ${LIBRAT}.so ${PRATOBJ} ${ANCOBJS}
${LIBRAT}.so:	${PRATOBJ} ${ANCOBJS} 

ifeq ($(OS),'Windows_NT')
	@env
	@cat makefile
	@echo "$(OS) indicates windows ... uh oh"
	$(DYN) -o ${LIBRAT}.dll -lc -lm --shared -Wl,--out-implib,${LIBRAT}.a ${PRATOBJ} ${ANCOBJS}
else
	@env
	@cat makefile
	@echo "making on OS $(OS)"
	$(DYN) -lc -lm  -undefined dynamic_lookup -o ${LIBRAT}.so ${PRATOBJ} ${ANCOBJS}
endif

${START}:	${STARTOBJS} ${LIBRAT}.so
		@mkdir -p ${BIN}/${ARCH}
		$(CC) $(CFLAGS) ${OPT} -L. -o ${BIN}/${ARCH}/$@  ${STARTOBJS} -lratlib -lm -lc

# object building

rpv.o:		
		@echo "I think Im on $(OS)"
		@cat makefile
		$(CC) ${OPT} -I. -DDOUBLEDEF  -D${ARCH} ${CFLAGS} -o rpv.o -c rpv.c
		

%.o:		%.c
		$(CC) ${OPT} -I. -DDOUBLEDEF  -D${ARCH} ${CFLAGS} -o $@ -c $<

clean:
		rm -f *% *.o ${PRATOBJ} ${ANCOBJS} ${STARTOBJS} ${LIBRAT}.so




