#
#
#
#       Makefile HIPS programs
#
#       Lewis, RSU, UCL Geography, 1993
#
#
#
#       build executables 
OBJ = objects.${ARCH}

BPMS = __BPMS__
LIBRARY = ${BPMS}/lib

CFLAGS = __CFLAGS__
MAKE = __MAKE__
WG = __WG__
WGET = __WGET__
CC = __CC__
DYN = __DYN__
OPT = __OPT__

CFLAGS += -I. -DMMAP  -DVERBOSE -DDOUBLEDEF -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
LIBS = liberr libimage librand libvect liballoc libmatrix libimage librat
#LIBS = librat

PRATOBJ = ${OBJ}/rpv.o ${OBJ}/cylinderTess.o ${OBJ}/sphereTess.o ${OBJ}/ratFront.o ${OBJ}/disk.o ${OBJ}/dummy.o ${OBJ}/dem.o ${OBJ}/bbox.o ${OBJ}/facet.o ${OBJ}/camera.o ${OBJ}/intersect_objects.o ${OBJ}/random.o ${OBJ}/plane.o ${OBJ}/reflectance.o ${OBJ}/volumeRayTrace.o ${OBJ}/sphere.o ${OBJ}/cylinder.o ${OBJ}/ellipse.o ${OBJ}/spheroid.o ${OBJ}/sky.o ${OBJ}/sensor_rsr.o ${OBJ}/files.o ${OBJ}/mtllib.o ${OBJ}/bilinear.o ${OBJ}/dumper.o
USEFUL = ${OBJ}/useful.o
WAVEFRONT = ${OBJ}/prat_wavefront_read.o
USRHIPL = ${OBJ}/images.o
USRLIBS = -lvect -lerr
CFLAGS += -DMATCHK -D${ARCH} -D_NO_NAG
NAG =


all:
		${MAKE} "BPMS=${BPMS}" ${LIBS} libratlib start

sick:		
		@echo "stick your fingers down your throat"

lib:
		${MAKE} "BPMS=${BPMS}" all

liberr:		makefile ${OBJ}/error.o


libimage:	makefile ${OBJ}/filelib.o ${OBJ}/hiplib.o ${OBJ}/envilib.o ${OBJ}/imagelib.o


libhipl:	${OBJ}/libhipl.o


librand:	makefile ${OBJ}/r250.o ${OBJ}/randlcg.o


libvect:	makefile ${OBJ}/4D_vectors.o ${OBJ}/vectors2.o ${OBJ}/2D_vectors.o ${OBJ}/2D_vectors_double.o ${OBJ}/3D_vectors_double.o



liballoc:	makefile ${OBJ}/allocate.o


libmatrix:	${OBJ}/matrix.o


librat:		makefile ${OBJ}/fratP.o $(USRHIPL) $(PRATOBJ) $(USEFUL) $(WAVEFRONT) ${FORTRANSTUFF} ${OBJ}/matherr.o


libratlib:	makefile
		@echo "archiving libratlib library"
		$(DYN) -o ${BPMS}/lib/libratlib_${ARCH}.so objects.${ARCH}/*.o





start:		makefile start.o
		$(CC) $(CFLAGS) -L${BPMS}/lib -L. -L${LIBRARY} -o $@ start.o -lratlib_${ARCH} -lm -lc
		@mv start ${BPMS}/bin/${ARCH}


${OBJ}/%.o:	%.c
		mkdir -p ${OBJ}
		$(CC) -I. -DDOUBLEDEF -I/usr/5include -D${ARCH} ${CFLAGS} -I${LIBRARY} -o $@ -c $<


# object building

.c.o:		makefile hiplib.h  $<
		$(CC) ${CFLAGS} -D${ARCH} -I. -c $< 

clean:
		rm -f *% *.o ${OBJ}/*.o ${BPMS}/lib/*_${ARCH}.so ${BPMS}/lib/*_${ARCH}.a






