#
#
#
#       Makefile librat
#
#       Lewis, RSU, UCL Geography, 1993
#
#
#
#       build executables 

START = start
LIBRAT = libratlib

ARCH = @ARCH@
OBJ = objects.${ARCH}

BPMS = @BPMS@
LIB = ${BPMS}/lib
BIN = ${BPMS}/bin

CFLAGS = @CFLAGS@
CC = @CC@
DYN = @DYN@
OPT = @OPT@

CFLAGS += -I. -DVERBOSE -DDOUBLEDEF -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
CFLAGS += -DMATCHK -D${ARCH} -D_NO_NAG

PRATOBJ = ${OBJ}/rpv.o ${OBJ}/cylinderTess.o ${OBJ}/sphereTess.o ${OBJ}/ratFront.o ${OBJ}/disk.o ${OBJ}/dummy.o ${OBJ}/dem.o ${OBJ}/bbox.o ${OBJ}/facet.o ${OBJ}/camera.o ${OBJ}/intersect_objects.o ${OBJ}/random.o ${OBJ}/plane.o ${OBJ}/reflectance.o ${OBJ}/volumeRayTrace.o ${OBJ}/sphere.o ${OBJ}/cylinder.o ${OBJ}/ellipse.o ${OBJ}/spheroid.o ${OBJ}/sky.o ${OBJ}/sensor_rsr.o ${OBJ}/files.o ${OBJ}/mtllib.o ${OBJ}/bilinear.o ${OBJ}/dumper.o ${OBJ}/useful.o ${OBJ}/prat_wavefront_read.o ${OBJ}/images.o ${OBJ}/start.o

ANCOBJS = ${OBJ}/error.o ${OBJ}/filelib.o ${OBJ}/hiplib.o ${OBJ}/envilib.o ${OBJ}/imagelib.o ${OBJ}/libhipl.o ${OBJ}/r250.o ${OBJ}/randlcg.o ${OBJ}/4D_vectors.o ${OBJ}/vectors2.o ${OBJ}/2D_vectors.o ${OBJ}/2D_vectors_double.o ${OBJ}/3D_vectors_double.o  ${OBJ}/allocate.o ${OBJ}/matrix.o ${OBJ}/fratP.o ${OBJ}/matherr.o

STARTOBJS = ${OBJ}/${START}.o

all:		${LIB}/${ARCH}/${LIBRAT}.so 


sick:
		@echo "stick your fingers down your throat"


${LIB}/${ARCH}/${LIBRAT}.so:	${PRATOBJ} ${ANCOBJS} 
		mkdir -p ${LIB}/${ARCH} 
		$(CC) -lc -lm  -o ${LIB}/${ARCH}/${LIBRAT}.so ${PRATOBJ} ${ANCOBJS}


${START}:	${STARTOBJS} ${LIB}/${ARCH}/${LIBRAT}.so
		@mkdir -p ${BIN}/${ARCH}
		$(CC) $(CFLAGS) ${OPT} -L${LIB}/${ARCH} -o ${BIN}/${ARCH}/$@  ${STARTOBJS} -lratlib -lm -lc

# object building


${OBJ}/%.o:	%.c
		@mkdir -p ${OBJ}
		$(CC) ${OPT} -I. -DDOUBLEDEF  -D${ARCH} ${CFLAGS} -o $@ -c $<

clean:
		rm -f *% *.o ${PRATOBJ} ${ANCOBJS} ${STARTOBJS} ${LIB}/${ARCH}/${LIBRAT}.so




